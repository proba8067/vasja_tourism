<!-- AR.js by @jerome_etienne - github: https://github.com/jeromeetienne/ar.js - info: https://medium.com/arjs/augmented-reality-in-10-lines-of-html-4e193ea9fdbf -->
<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"></script>
<script>

var zahtev=0;
//setTimeout(send(),500);

const sleep = (milliseconds) => {
  return new Promise(resolve => setTimeout(resolve, milliseconds))
}

AFRAME.registerComponent('soundhandler', {
    tick: async function () {
//var m1 = document.querySelector('#sound1');
// var m2 = document.querySelector('#sound2');
//  var m3 = document.querySelector('#sound3');
 //m1.loop=true;
 //m2.loop=true;
 

	
    if (document.querySelector('#marker1').object3D.visible == true && zahtev==0) {	
//alert('uso1');
	zahtev=1;
	const http=new XMLHttpRequest();
	const url='http://192.168.234.94:3000/komanda=1';	 	
	
/*
	http.open("GET",url);
			http.send(); 
			zahtev=0;*/
			
			sleep(1000).then(() => {
				console.log("1");
					http.open("GET",url);
			http.send(); 
				zahtev=0;
			})

    } else {
    
		
	if (document.querySelector('#marker2').object3D.visible == true && zahtev==0) {	
	//alert('uso1');
	zahtev=1;
		const http=new XMLHttpRequest();
	const url='http://192.168.234.94:3000/komanda=2';	 
		/*
		http.open("GET",url);
		http.send(); 
		zahtev=0;*/
						sleep(1000).then(() => {
				console.log("2");
					http.open("GET",url);
			http.send(); 
				zahtev=0;
			})


    } else {
	if (document.querySelector('#marker3').object3D.visible == true && zahtev==0) {	
	//alert('uso3');
	zahtev=1;
		const http=new XMLHttpRequest();
	const url='http://192.168.234.94:3000/komanda=3';	 
		/*
		http.open("GET",url);
		http.send(); 
		zahtev=0;*/
	sleep(1000).then(() => {
				console.log("3");
					http.open("GET",url);
			http.send(); 
				zahtev=0;
			})

    }
	
	
    }
}
}	
});


</script>


<body style='margin : 0px; overflow: hidden;'>
	<a-scene embedded arjs='sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'>
	
	<a-assets>
            <!--
			<audio id="sound1" src="RELAY1.wav" preload="auto"></audio>
			<audio id="sound2" src="RELAY2.wav" preload="auto"></audio>
			<audio id="sound3" src="RELAY3.wav" preload="auto"></audio>
			-->
    </a-assets>
	
	
	<a-marker id='marker1' type='barcode' value='1'  cursor='rayOrigin: mouse'>
			<a-box id='m1' position='0 0.5 0'  material='opacity: 0.5; color:blue;' soundhandler>
			<a-text value="Dovicin, Price: 1 eur, Available: 10" rotation="-90 0 0" height="10" width="10" color="red"></a-text>
			</a-box>
		</a-marker>
	
	
	<a-marker id='marker2' type='barcode'  value='2' cursor='rayOrigin: mouse'>
			<a-box id='m2' position='0 0.5 0' material='opacity: 0.5; color:pink;' soundhandler>
			<a-text value="Brufen, Price: 1.5 eur, Available: 50" rotation="-90 0 0" height="10" width="10" color="red"></a-text>

			</a-box>
	</a-marker>
	
	
		
	<a-marker id='marker3' type='barcode'  value='3' cursor='rayOrigin: mouse'>
			<a-box id='m3' position='0 0.5 0' material='opacity: 0.5; color:blue;' soundhandler>
			<a-text value="Analgin, Price: 1 eur, Available: 14" rotation="-90 0 0" height="10" width="10" color="red"></a-text>

			</a-box>
	</a-marker>
	

	</a-scene>
</body>
